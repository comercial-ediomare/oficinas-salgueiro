<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Inscrição nas Oficinas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      margin: 2rem auto;
      max-width: 860px;
      color: #222;
      padding: 0 1rem;
      background-color: #f2e9ea;
    }
    h1 {
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      margin-bottom: 1rem;
      color: #5f634a;
      flex-wrap: wrap;
    }
    h1 img {
      width: 100%;
      height: auto;
      vertical-align: middle;
    }
    form { margin-top: 1rem; }
    fieldset.slot {
      margin: 1.25em 0;
      padding: 1em;
      border: 2px solid #731240;      /* borda combinando com o texto */
      border-radius: 10px;
      background: #a8ac8c;            /* fundo solicitado */
      color: #f2e9ea;                 /* texto solicitado */
    }
    legend {
      font-weight: bold;
      color: #731240;                 /* cor do título do horário */
    }
    label { display: block; margin-bottom: .45em; }
    label.bloqueada { color: #888; }
    label.bloqueada small { color: #aaa; }
    .flash {
      padding: 1em;
      border-radius: 6px;
      margin-bottom: 1em;
    }
    .flash.error {
      background: #ffe0e0;
      color: #a00;
      border: 1px solid #f99;
    }
    .flash.message {
      background: #e0f8e0;
      color: #060;
      border: 1px solid #9c9;
    }
    input[type="text"], input[type="email"] {
      width: 98%;
      padding: .6em;
      border: 1px solid #bbb;
      border-radius: 6px;
      margin-top: .25em;
    }
    input[type="radio"] {
      accent-color: #731240;          /* cor dos botões de opção */
    }
    button {
      background: #731240;
      color: #fff;
      border: none;
      padding: .75em 1.5em;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 1rem;
    }
    button:hover { background: #5a0f33; }
    small.muted { color: #5f5f5f; }
  </style>
</head>
<body>
  <h1><img src="{{ url_for('static', filename='logo.png') }}" alt="Logo da Conferência"></h1>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for cat, msg in messages %}
        <div class="flash {{ cat }}">{{ msg }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form method="post" action="{{ url_for('inscrever') }}">
    <label>Nome completo:
      <input type="text" name="full_name" required>
    </label>

    <label style="margin-top:.6em;">E-mail:
      <input type="email" name="email" required>
    </label>

    <p><strong>Escolha de 1 a 4 oficinas (no máximo uma por horário e sem repetir a mesma oficina em horários distintos):</strong></p>

    {% for slot in slots %}
      <fieldset class="slot">
        <legend>{{ loop.index }}º Horário — {{ slot.hora }}</legend>
        <div class="oficinas">
          {% for w in workshops %}
            {% if w["name"] not in slot.bloqueadas %}
              <label>
                <input type="radio"
                       class="opt"
                       name="slot_{{ slot.id }}"
                       value="{{ w['id'] }}"
                       data-workshop-id="{{ w['id'] }}"
                       data-slot-id="{{ slot.id }}"
                       onchange="updateSlots()">
                {{ w["name"] }}
              </label>
            {% else %}
              <label class="bloqueada">
                <input type="radio" disabled>
                {{ w["name"] }} <small class="muted">(não disponível neste horário)</small>
              </label>
            {% endif %}
          {% endfor %}
          <!-- opção de não escolher nada neste horário -->
          <label>
            <input type="radio"
                   class="opt"
                   name="slot_{{ slot.id }}"
                   value=""
                   data-slot-id="{{ slot.id }}"
                   onchange="updateSlots()">
            NÃO ESCOLHER NESTE HORÁRIO
          </label>
        </div>
      </fieldset>
    {% endfor %}

    <p>
      <label>
        <input type="checkbox" name="consent" required>
        Autorizo o uso dos meus dados para organização das oficinas.
      </label>
    </p>

    <button type="submit" id="submitBtn" disabled>Enviar inscrição</button>
  </form>

  <script>
    function updateSlots() {
      // Agrupa radios por oficina (mesmo ID em slots diferentes)
      const radios = Array.from(document.querySelectorAll('input[type="radio"].opt'));
      const byWorkshop = new Map(); // id -> [radios]
      radios.forEach(r => {
        const wid = r.dataset.workshopId;
        if (!wid) return; // ignora "Não escolher neste horário"
        if (!byWorkshop.has(wid)) byWorkshop.set(wid, []);
        byWorkshop.get(wid).push(r);
      });

      // Reabilita todos
      byWorkshop.forEach(list => list.forEach(r => r.disabled = false));

      // Desabilita oficinas já escolhidas em outros horários
      byWorkshop.forEach(list => {
        const checked = list.find(r => r.checked && r.value);
        if (checked) list.forEach(r => { if (r !== checked) r.disabled = true; });
      });

      // Habilita o submit se nº de escolhas (com valor) ∈ [1,4]
      const chosenCount = Array.from(document.querySelectorAll('input[type="radio"][name^="slot_"]:checked'))
                               .filter(r => r.value).length;
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = !(chosenCount >= 1 && chosenCount <= 4);
    }

    document.addEventListener('DOMContentLoaded', updateSlots);
  </script>
</body>
</html>



