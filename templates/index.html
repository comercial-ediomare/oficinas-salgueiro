<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inscrição nas Oficinas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 2rem auto;
      padding: 1rem;
      background: #f8f9fa;
    }
    h1 {
      color: #222;
      text-align: center;
    }
    form {
      background: #fff;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,.1);
    }
    section {
      margin-top: 1.5rem;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #fafafa;
    }
    section h3 {
      margin-top: 0;
      color: #003366;
    }
    label {
      display: block;
      margin: .3rem 0;
      cursor: pointer;
    }
    small {
      color: #a00;
    }
    .btn {
      background: #003366;
      color: #fff;
      padding: .75rem 1.5rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      margin-top: 1rem;
    }
    .btn:hover {
      background: #00509e;
    }
    .msg {
      margin-bottom: 1rem;
      padding: .5rem;
      border-radius: 4px;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
    }
    .message {
      background: #d4edda;
      color: #155724;
    }
  </style>
</head>
<body>
  <h1>Inscrição nas Oficinas</h1>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for cat, msg in messages %}
        <div class="msg {{ cat }}">{{ msg }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form method="post" action="{{ url_for('inscrever') }}">
    <label>Nome completo:
      <input type="text" name="full_name" required style="width:100%; padding:.5rem; margin-top:.25rem;">
    </label>

    <label>E-mail:
      <input type="email" name="email" required style="width:100%; padding:.5rem; margin-top:.25rem;">
    </label>

    <!-- HORÁRIOS -->
    {% for slot in slots %}
      <section>
        <h3>{{ loop.index }}º Horário — {{ slot.hora }}</h3>
        {% set bloqueadas = slot.bloqueadas %}
        {% for w in workshops %}
          {% set disabled = (w.name in bloqueadas) %}
          <label>
            <input type="radio"
                   name="slot_{{ slot.id }}"
                   value="{{ w.id }}"
                   {% if disabled %}disabled{% endif %}
                   class="oficina-radio"
                   data-wid="{{ w.id }}">
            {{ w.name }}
            {% if disabled %}
              <small>(indisponível neste horário)</small>
            {% endif %}
          </label>
        {% endfor %}
      </section>
    {% endfor %}

    <label style="margin-top:1rem;">
      <input type="checkbox" name="consent" required>
      Concordo com o tratamento dos meus dados conforme a LGPD.
    </label>

    <button type="submit" class="btn">Enviar Inscrição</button>
  </form>

  <script>
    // Impedir escolher a mesma oficina em horários diferentes
    const radios = document.querySelectorAll('.oficina-radio');
    radios.forEach(r => {
      r.addEventListener('change', () => {
        const selectedId = r.dataset.wid;
        // Desmarca qualquer outro com o mesmo value em horários diferentes
        radios.forEach(other => {
          if (other !== r && other.dataset.wid === selectedId) {
            other.checked = false;
          }
        });
      });
    });
  </script>
</body>
</html>
